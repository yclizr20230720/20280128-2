<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generative UI ‚Äî Live Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #05070f;
    --surface: #0c1120;
    --surface2: #121929;
    --border: #1e2d4a;
    --accent: #00e5ff;
    --accent2: #7c3aed;
    --accent3: #f59e0b;
    --text: #e2eaf8;
    --text-dim: #6b7fa3;
    --danger: #ef4444;
    --success: #22c55e;
    --warn: #f59e0b;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,229,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,229,255,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    animation: gridShift 20s linear infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes gridShift {
    0% { transform: translateY(0); }
    100% { transform: translateY(60px); }
  }

  /* Header */
  .header {
    position: relative;
    z-index: 10;
    padding: 32px 48px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(5,7,15,0.8);
    backdrop-filter: blur(16px);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
  }

  .logo-text {
    font-size: 20px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }

  .logo-text span { color: var(--accent); }

  .header-badge {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .badge {
    padding: 4px 12px;
    border-radius: 100px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .badge-live {
    background: rgba(239,68,68,0.15);
    border: 1px solid rgba(239,68,68,0.4);
    color: var(--danger);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .badge-live::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--danger);
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .badge-demo {
    background: rgba(0,229,255,0.1);
    border: 1px solid rgba(0,229,255,0.3);
    color: var(--accent);
  }

  /* Main layout */
  .main {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 280px 1fr;
    height: calc(100vh - 89px);
  }

  /* Sidebar */
  .sidebar {
    border-right: 1px solid var(--border);
    background: rgba(12,17,32,0.6);
    padding: 24px 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .sidebar-title {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 4px;
  }

  /* User selector */
  .user-cards {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .user-card {
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--surface);
    cursor: pointer;
    transition: all 0.25s ease;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .user-card:hover {
    border-color: rgba(0,229,255,0.3);
    background: var(--surface2);
  }

  .user-card.active {
    border-color: var(--accent);
    background: rgba(0,229,255,0.06);
    box-shadow: 0 0 20px rgba(0,229,255,0.1);
  }

  .user-avatar {
    width: 32px; height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .user-info { flex: 1; }
  .user-name { font-size: 13px; font-weight: 600; line-height: 1; }
  .user-role { font-size: 10px; color: var(--text-dim); margin-top: 2px; font-family: 'Space Mono', monospace; }

  /* Context panel */
  .context-items {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .context-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-radius: 6px;
    background: var(--surface);
    border: 1px solid var(--border);
    font-size: 11px;
  }

  .context-key { color: var(--text-dim); font-family: 'Space Mono', monospace; }
  .context-val { font-weight: 600; }

  .status-dot {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .status-dot::before {
    content: '';
    width: 6px; height: 6px;
    border-radius: 50%;
    display: inline-block;
  }

  .status-dot.critical::before { background: var(--danger); animation: pulse 1s infinite; }
  .status-dot.normal::before { background: var(--success); }
  .status-dot.warn::before { background: var(--warn); }

  /* Trigger button */
  .trigger-btn {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid rgba(0,229,255,0.4);
    background: linear-gradient(135deg, rgba(0,229,255,0.08), rgba(124,58,237,0.08));
    color: var(--accent);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s ease;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  .trigger-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(0,229,255,0.12), rgba(124,58,237,0.12));
    opacity: 0;
    transition: opacity 0.25s;
  }

  .trigger-btn:hover::before { opacity: 1; }
  .trigger-btn:hover { box-shadow: 0 0 24px rgba(0,229,255,0.2); transform: translateY(-1px); }

  /* Main content area */
  .content {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Gen UI display */
  .gen-ui-area {
    flex: 1;
    overflow-y: auto;
    padding: 32px;
    position: relative;
  }

  /* Generation animation */
  .generating-overlay {
    position: absolute;
    inset: 0;
    background: rgba(5,7,15,0.85);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    z-index: 100;
    backdrop-filter: blur(4px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .generating-overlay.active {
    opacity: 1;
    pointer-events: all;
  }

  .gen-spinner {
    width: 48px; height: 48px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .gen-text {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: var(--accent);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  /* Dynamic UI panels */
  .ui-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 16px;
    animation: panelIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) both;
  }

  @keyframes panelIn {
    from { opacity: 0; transform: translateY(16px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  .panel-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.02);
  }

  .panel-title {
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .panel-tag {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 100px;
    background: rgba(0,229,255,0.1);
    color: var(--accent);
    border: 1px solid rgba(0,229,255,0.2);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .panel-body { padding: 20px; }

  /* Metric cards */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }

  .metric-card {
    padding: 16px;
    border-radius: 10px;
    background: var(--surface2);
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .metric-card::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 2px;
    background: var(--accent-color, var(--accent));
  }

  .metric-label { font-size: 10px; color: var(--text-dim); font-family: 'Space Mono', monospace; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; }
  .metric-value { font-size: 26px; font-weight: 800; line-height: 1; }
  .metric-sub { font-size: 10px; margin-top: 6px; }

  /* Wafer map */
  .wafer-container {
    display: flex;
    gap: 20px;
    align-items: flex-start;
  }

  .wafer-map {
    width: 180px; height: 180px;
    border-radius: 50%;
    border: 2px solid var(--border);
    position: relative;
    background: var(--surface2);
    flex-shrink: 0;
    overflow: hidden;
  }

  .wafer-cell {
    position: absolute;
    width: 12px; height: 12px;
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .wafer-info { flex: 1; }
  .wafer-legend { display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-dim); }
  .legend-dot { width: 10px; height: 10px; border-radius: 2px; }

  /* SPC Chart */
  .spc-chart {
    height: 100px;
    background: var(--surface2);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    margin-bottom: 12px;
  }

  .spc-line {
    position: absolute;
    bottom: 50%;
    left: 0; right: 0;
    height: 1px;
    background: rgba(0,229,255,0.3);
  }

  .spc-line.ucl { bottom: 80%; background: rgba(239,68,68,0.4); }
  .spc-line.lcl { bottom: 20%; background: rgba(239,68,68,0.4); }

  .spc-points {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: flex-end;
    padding: 8px;
    gap: 6px;
  }

  .spc-point {
    width: 6px;
    border-radius: 2px 2px 0 0;
    transition: height 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* SOP steps */
  .sop-steps { display: flex; flex-direction: column; gap: 8px; }

  .sop-step {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 12px;
    border-radius: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    transition: all 0.25s;
  }

  .sop-step.active {
    border-color: var(--accent);
    background: rgba(0,229,255,0.05);
  }

  .sop-step.done {
    opacity: 0.5;
  }

  .step-num {
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--surface);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    flex-shrink: 0;
  }

  .sop-step.active .step-num {
    background: var(--accent);
    color: var(--bg);
    border-color: var(--accent);
    font-weight: 700;
  }

  .sop-step.done .step-num {
    background: var(--success);
    border-color: var(--success);
    color: var(--bg);
  }

  .step-text { font-size: 12px; line-height: 1.5; padding-top: 2px; }
  .step-desc { font-size: 10px; color: var(--text-dim); margin-top: 2px; }

  /* Alert banner */
  .alert-banner {
    padding: 12px 16px;
    border-radius: 8px;
    border-left: 3px solid;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .alert-banner.critical {
    background: rgba(239,68,68,0.08);
    border-color: var(--danger);
    color: #fca5a5;
  }

  .alert-banner.warn {
    background: rgba(245,158,11,0.08);
    border-color: var(--warn);
    color: #fcd34d;
  }

  .alert-icon { font-size: 16px; flex-shrink: 0; }
  .alert-text { flex: 1; }
  .alert-time { font-family: 'Space Mono', monospace; font-size: 10px; opacity: 0.7; }

  /* KPI table */
  .kpi-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .kpi-table th {
    text-align: left;
    padding: 8px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-dim);
    border-bottom: 1px solid var(--border);
  }
  .kpi-table td {
    padding: 10px 12px;
    border-bottom: 1px solid rgba(30,45,74,0.5);
  }
  .kpi-table tr:last-child td { border-bottom: none; }
  .kpi-change { font-size: 10px; }
  .kpi-change.pos { color: var(--success); }
  .kpi-change.neg { color: var(--danger); }

  /* Quick actions */
  .quick-actions { display: flex; gap: 8px; flex-wrap: wrap; }

  .quick-btn {
    padding: 8px 14px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .quick-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0,229,255,0.05);
  }

  .quick-btn.primary {
    background: rgba(0,229,255,0.1);
    border-color: var(--accent);
    color: var(--accent);
  }

  /* Bottom bar */
  .bottom-bar {
    padding: 12px 32px;
    border-top: 1px solid var(--border);
    background: rgba(12,17,32,0.8);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .gen-info {
    display: flex;
    align-items: center;
    gap: 16px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
  }

  .gen-info span { display: flex; align-items: center; gap: 4px; }

  .why-btn {
    padding: 6px 14px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-dim);
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Syne', sans-serif;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .why-btn:hover { border-color: var(--accent2); color: #a78bfa; }

  /* Tooltip */
  .why-tooltip {
    position: fixed;
    bottom: 60px;
    right: 32px;
    background: var(--surface2);
    border: 1px solid var(--accent2);
    border-radius: 10px;
    padding: 16px;
    width: 280px;
    font-size: 11px;
    line-height: 1.6;
    color: var(--text);
    box-shadow: 0 8px 40px rgba(0,0,0,0.5);
    z-index: 200;
    animation: fadeIn 0.2s ease;
    display: none;
  }

  .why-tooltip.show { display: block; }
  .why-tooltip-title { font-weight: 700; color: #a78bfa; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
  .why-item { margin-bottom: 6px; color: var(--text-dim); }
  .why-item strong { color: var(--text); }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* Initial state */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    gap: 16px;
    color: var(--text-dim);
    text-align: center;
  }

  .empty-icon { font-size: 48px; opacity: 0.3; }
  .empty-title { font-size: 18px; font-weight: 600; }
  .empty-sub { font-size: 12px; font-family: 'Space Mono', monospace; }

  /* Section header */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .section-title {
    font-size: 13px;
    font-weight: 800;
    letter-spacing: -0.3px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .gen-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 100px;
    background: rgba(124,58,237,0.15);
    border: 1px solid rgba(124,58,237,0.3);
    color: #a78bfa;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* Scroll */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <div class="logo-icon">‚ö°</div>
    <div class="logo-text">Generative<span>UI</span> Engine</div>
  </div>
  <div class="header-badge">
    <div class="badge badge-live">Live</div>
    <div class="badge badge-demo">Intelligent Manufacturing Demo</div>
  </div>
</div>

<!-- Main -->
<div class="main">
  <!-- Sidebar -->
  <div class="sidebar">
    <!-- User selector -->
    <div>
      <div class="sidebar-title">‚ë† Select User Role</div>
      <div class="user-cards" id="userCards">
        <div class="user-card active" data-role="engineer" onclick="selectUser(this)">
          <div class="user-avatar" style="background:rgba(0,229,255,0.15);color:var(--accent)">üë®‚Äçüî¨</div>
          <div class="user-info">
            <div class="user-name">Senior Engineer</div>
            <div class="user-role">ENG ¬∑ 8 YRS EXP</div>
          </div>
        </div>
        <div class="user-card" data-role="manager" onclick="selectUser(this)">
          <div class="user-avatar" style="background:rgba(245,158,11,0.15);color:var(--accent3)">üëî</div>
          <div class="user-info">
            <div class="user-name">Production Manager</div>
            <div class="user-role">MGR ¬∑ FAB OPS</div>
          </div>
        </div>
        <div class="user-card" data-role="newbie" onclick="selectUser(this)">
          <div class="user-avatar" style="background:rgba(34,197,94,0.15);color:var(--success)">üî∞</div>
          <div class="user-info">
            <div class="user-name">New Operator</div>
            <div class="user-role">OPR ¬∑ 3 MO EXP</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Context -->
    <div>
      <div class="sidebar-title">‚ë° Live Context Engine</div>
      <div class="context-items">
        <div class="context-item">
          <span class="context-key">SYSTEM STATE</span>
          <span class="context-val"><span class="status-dot critical">EXCURSION</span></span>
        </div>
        <div class="context-item">
          <span class="context-key">EQUIPMENT</span>
          <span class="context-val">CVD-08</span>
        </div>
        <div class="context-item">
          <span class="context-key">LOT ID</span>
          <span class="context-val">L-2024-A7</span>
        </div>
        <div class="context-item">
          <span class="context-key">SHIFT</span>
          <span class="context-val">02:15 AM</span>
        </div>
        <div class="context-item">
          <span class="context-key">YIELD DELTA</span>
          <span class="context-val" style="color:var(--danger)">‚àí11.3%</span>
        </div>
        <div class="context-item">
          <span class="context-key">TIME PRESSURE</span>
          <span class="context-val" style="color:var(--warn)">HIGH</span>
        </div>
      </div>
    </div>

    <!-- Generate button -->
    <div>
      <div class="sidebar-title">‚ë¢ Generate UI</div>
      <button class="trigger-btn" onclick="generateUI()">
        ‚ö° Generate Adaptive Interface
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="gen-ui-area" id="genUIArea">
      <div class="generating-overlay" id="generatingOverlay">
        <div class="gen-spinner"></div>
        <div class="gen-text">Analyzing Context & Generating UI...</div>
      </div>

      <div class="empty-state" id="emptyState">
        <div class="empty-icon">üß†</div>
        <div class="empty-title">Select a role and click Generate</div>
        <div class="empty-sub">The AI will craft a personalized interface based on context</div>
      </div>

      <div id="dynamicUI" style="display:none"></div>
    </div>

    <div class="bottom-bar" id="bottomBar" style="display:none">
      <div class="gen-info">
        <span>ü§ñ Generated for: <strong id="genRole"></strong></span>
        <span>‚ö° Latency: <strong id="genLatency"></strong>ms</span>
        <span>üéØ Confidence: <strong>96.2%</strong></span>
      </div>
      <div style="display:flex;gap:8px">
        <button class="why-btn" onclick="toggleWhy()">üîç Why this UI?</button>
        <button class="why-btn" onclick="generateUI()">üîÑ Regenerate</button>
      </div>
    </div>
  </div>
</div>

<!-- Why tooltip -->
<div class="why-tooltip" id="whyTooltip">
  <div class="why-tooltip-title">üß† UI Generation Reasoning</div>
  <div id="whyContent"></div>
</div>

<script>
let currentRole = 'engineer';

function selectUser(el) {
  document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  currentRole = el.dataset.role;
}

function generateUI() {
  const overlay = document.getElementById('generatingOverlay');
  const emptyState = document.getElementById('emptyState');
  const dynamicUI = document.getElementById('dynamicUI');
  const bottomBar = document.getElementById('bottomBar');

  emptyState.style.display = 'none';
  dynamicUI.style.display = 'none';
  overlay.classList.add('active');

  const latency = 800 + Math.random() * 600;

  setTimeout(() => {
    overlay.classList.remove('active');
    dynamicUI.style.display = 'block';
    bottomBar.style.display = 'flex';

    document.getElementById('genLatency').textContent = Math.round(latency);
    document.getElementById('genRole').textContent = {
      engineer: 'Senior Engineer',
      manager: 'Production Manager',
      newbie: 'New Operator'
    }[currentRole];

    renderUI(currentRole);
    document.getElementById('whyTooltip').classList.remove('show');
  }, latency);
}

function renderUI(role) {
  const container = document.getElementById('dynamicUI');

  if (role === 'engineer') {
    container.innerHTML = `
      <div class="section-header">
        <div class="section-title">üìä Excursion Analysis Dashboard <span class="gen-label">AI-Generated</span></div>
      </div>

      <div class="alert-banner critical">
        <span class="alert-icon">üö®</span>
        <div class="alert-text"><strong>Yield Excursion Detected</strong> ‚Äî CVD-08 deposition uniformity out of spec. Lot L-2024-A7 quarantined.</div>
        <span class="alert-time">02:12 AM</span>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üó∫Ô∏è Wafer Map + Anomaly Zone <span class="panel-tag">SPC</span></div>
        </div>
        <div class="panel-body">
          <div class="wafer-container">
            <div class="wafer-map" id="waferMap"></div>
            <div class="wafer-info">
              <div class="wafer-legend">
                <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div>Pass</div>
                <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div>Fail</div>
                <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Marginal</div>
                <div class="legend-item"><div class="legend-dot" style="background:#6b7fa3"></div>Edge</div>
              </div>
              <div style="font-size:11px;color:var(--text-dim);line-height:1.7">
                <div>Die yield: <strong style="color:var(--danger)">78.4%</strong> (target ‚â•90%)</div>
                <div>Fail cluster: <strong>Upper-right quadrant</strong></div>
                <div>Root cause hypothesis: <strong>CVD gas flow deviation</strong></div>
                <div>Affected die: <strong>47 / 216</strong></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üìà SPC Trend ‚Äî Last 24h <span class="panel-tag">Real-time</span></div>
        </div>
        <div class="panel-body">
          <div class="spc-chart" id="spcChart">
            <div class="spc-line ucl"></div>
            <div class="spc-line"></div>
            <div class="spc-line lcl"></div>
            <div class="spc-points" id="spcPoints"></div>
          </div>
          <div style="display:flex;gap:16px;font-size:10px;font-family:'Space Mono',monospace;color:var(--text-dim)">
            <span><span style="color:var(--danger)">‚Äî</span> UCL: 95.2%</span>
            <span><span style="color:var(--accent)">‚Äî</span> Mean: 91.0%</span>
            <span><span style="color:var(--danger)">‚Äî</span> LCL: 86.8%</span>
          </div>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">‚öôÔ∏è Parameter Adjustment Panel <span class="panel-tag">Direct Control</span></div>
        </div>
        <div class="panel-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
            <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px">
              <div style="font-size:10px;color:var(--text-dim);font-family:'Space Mono',monospace;margin-bottom:6px">GAS FLOW (SCCM)</div>
              <div style="font-size:20px;font-weight:800;color:var(--danger)">482 <span style="font-size:11px;color:var(--text-dim)">/ 500</span></div>
              <div style="height:4px;background:var(--border);border-radius:2px;margin-top:8px"><div style="height:100%;width:96%;background:var(--danger);border-radius:2px"></div></div>
            </div>
            <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px">
              <div style="font-size:10px;color:var(--text-dim);font-family:'Space Mono',monospace;margin-bottom:6px">TEMP (¬∞C)</div>
              <div style="font-size:20px;font-weight:800;color:var(--warn)">397 <span style="font-size:11px;color:var(--text-dim)">/ 400</span></div>
              <div style="height:4px;background:var(--border);border-radius:2px;margin-top:8px"><div style="height:100%;width:99%;background:var(--warn);border-radius:2px"></div></div>
            </div>
          </div>
          <div class="quick-actions">
            <button class="quick-btn primary">üîß Auto-correct Parameters</button>
            <button class="quick-btn">üìã Compare Last Run</button>
            <button class="quick-btn">üìû Escalate to Senior</button>
            <button class="quick-btn">üìù Log Incident</button>
          </div>
        </div>
      </div>`;

    // Render wafer map
    renderWaferMap();
    renderSPC();

  } else if (role === 'manager') {
    container.innerHTML = `
      <div class="section-header">
        <div class="section-title">üìä Impact Assessment & Recovery <span class="gen-label">AI-Generated</span></div>
      </div>

      <div class="alert-banner critical">
        <span class="alert-icon">‚ö†Ô∏è</span>
        <div class="alert-text"><strong>Excursion Impact ‚Äî Action Required</strong> ‚Äî CVD-08 offline. 3 lots affected. Est. recovery: 4.5h.</div>
        <span class="alert-time">Now</span>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üìà KPI Impact Summary <span class="panel-tag">Executive</span></div>
        </div>
        <div class="panel-body">
          <div class="metrics-grid">
            <div class="metric-card" style="--accent-color:#ef4444">
              <div class="metric-label">Yield Loss</div>
              <div class="metric-value" style="color:var(--danger)">‚àí11.3%</div>
              <div class="metric-sub" style="color:var(--text-dim)">3 lots affected</div>
            </div>
            <div class="metric-card" style="--accent-color:#f59e0b">
              <div class="metric-label">Est. Recovery</div>
              <div class="metric-value" style="color:var(--warn)">4.5h</div>
              <div class="metric-sub" style="color:var(--text-dim)">If action now</div>
            </div>
            <div class="metric-card" style="--accent-color:#ef4444">
              <div class="metric-label">Wafers at Risk</div>
              <div class="metric-value" style="color:var(--danger)">96</div>
              <div class="metric-sub" style="color:var(--text-dim)">3 lots √ó 32W</div>
            </div>
            <div class="metric-card" style="--accent-color:#22c55e">
              <div class="metric-label">Buffer Stock</div>
              <div class="metric-value" style="color:var(--success)">22%</div>
              <div class="metric-sub" style="color:var(--text-dim)">Can absorb loss</div>
            </div>
          </div>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üìã Affected Orders & Risk <span class="panel-tag">Business</span></div>
        </div>
        <div class="panel-body">
          <table class="kpi-table">
            <thead>
              <tr><th>Customer</th><th>Order</th><th>Delivery</th><th>Risk</th><th>Action</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>TSMC-A</td><td>L-2024-A7</td><td>Feb 26</td>
                <td><span style="color:var(--danger)">üî¥ HIGH</span></td>
                <td><button class="quick-btn" style="padding:4px 10px;font-size:10px">Notify</button></td>
              </tr>
              <tr>
                <td>Samsung-B</td><td>L-2024-B2</td><td>Mar 1</td>
                <td><span style="color:var(--warn)">üü° MED</span></td>
                <td><button class="quick-btn" style="padding:4px 10px;font-size:10px">Monitor</button></td>
              </tr>
              <tr>
                <td>Internal</td><td>L-2024-C1</td><td>Mar 5</td>
                <td><span style="color:var(--success)">üü¢ LOW</span></td>
                <td><button class="quick-btn" style="padding:4px 10px;font-size:10px">OK</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üéØ Decision Actions <span class="panel-tag">Manager</span></div>
        </div>
        <div class="panel-body">
          <div class="quick-actions">
            <button class="quick-btn primary">üö® Escalate to Fab Director</button>
            <button class="quick-btn">üìß Draft Customer Notification</button>
            <button class="quick-btn">üîÑ Reroute Lots</button>
            <button class="quick-btn">üìä Download Impact Report</button>
          </div>
        </div>
      </div>`;

  } else if (role === 'newbie') {
    container.innerHTML = `
      <div class="section-header">
        <div class="section-title">üìñ Step-by-Step Response Guide <span class="gen-label">AI-Generated</span></div>
      </div>

      <div class="alert-banner warn">
        <span class="alert-icon">üîî</span>
        <div class="alert-text"><strong>Equipment Alarm ‚Äî CVD-08</strong> ‚Äî Don't panic. Follow these steps carefully. Help is available.</div>
        <span class="alert-time">02:12 AM</span>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üìã SOP: Excursion Response <span class="panel-tag">Guided</span></div>
        </div>
        <div class="panel-body">
          <div class="sop-steps">
            <div class="sop-step done">
              <div class="step-num">‚úì</div>
              <div>
                <div class="step-text">Acknowledge the alarm in MES system</div>
                <div class="step-desc">Click "Acknowledge" on the alarm notification panel</div>
              </div>
            </div>
            <div class="sop-step active">
              <div class="step-num">2</div>
              <div>
                <div class="step-text">‚¨ÖÔ∏è <strong>You are here</strong> ‚Äî Do NOT touch equipment controls</div>
                <div class="step-desc">Place the equipment in HOLD status by clicking the yellow HOLD button in MES</div>
              </div>
            </div>
            <div class="sop-step">
              <div class="step-num">3</div>
              <div>
                <div class="step-text">Contact your Shift Supervisor immediately</div>
                <div class="step-desc">Call extension #4421 or use the radio on channel 3</div>
              </div>
            </div>
            <div class="sop-step">
              <div class="step-num">4</div>
              <div>
                <div class="step-text">Document what you observed</div>
                <div class="step-desc">Note the time, machine state, and any unusual sounds or readings</div>
              </div>
            </div>
            <div class="sop-step">
              <div class="step-num">5</div>
              <div>
                <div class="step-text">Wait for Senior Engineer to take over</div>
                <div class="step-desc">Stay near the equipment to provide information. Don't start repairs yourself.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">üÜò Quick Contacts <span class="panel-tag">Emergency</span></div>
        </div>
        <div class="panel-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <button class="quick-btn primary" style="justify-content:center;padding:14px">
              üìû Call Shift Supervisor<br><span style="font-family:'Space Mono',monospace;font-size:10px">Ext. 4421</span>
            </button>
            <button class="quick-btn" style="justify-content:center;padding:14px">
              üí¨ Message Senior Eng<br><span style="font-family:'Space Mono',monospace;font-size:10px">Ext. 3318</span>
            </button>
          </div>
        </div>
      </div>

      <div class="ui-panel">
        <div class="panel-header">
          <div class="panel-title">‚ùì What does this mean? <span class="panel-tag">Learning</span></div>
        </div>
        <div class="panel-body" style="font-size:12px;line-height:1.8;color:var(--text-dim)">
          A <strong style="color:var(--text)">yield excursion</strong> means the equipment produced more defective chips than expected. 
          This happens sometimes due to temperature or gas flow changes. <strong style="color:var(--text)">It's not your fault</strong> ‚Äî 
          your job is to stop the process and get help quickly. The faster we respond, the fewer wafers are affected.
        </div>
      </div>`;
  }

  // Update why content
  const whyContent = {
    engineer: `
      <div class="why-item">üìå <strong>Wafer Map shown</strong>: 8yr exp ‚Üí spatial analysis is instinctive</div>
      <div class="why-item">üìå <strong>SPC chart shown</strong>: Can interpret control limits directly</div>
      <div class="why-item">üìå <strong>Parameter panel shown</strong>: Has authority to adjust equipment</div>
      <div class="why-item">üìå <strong>No SOP guide</strong>: Would find step-by-step patronizing</div>`,
    manager: `
      <div class="why-item">üìå <strong>KPI metrics shown</strong>: Needs business impact not technical detail</div>
      <div class="why-item">üìå <strong>Order table shown</strong>: Customer delivery risk is primary concern</div>
      <div class="why-item">üìå <strong>Decision actions</strong>: Needs escalation & comms tools, not repair tools</div>
      <div class="why-item">üìå <strong>No wafer map</strong>: Technical detail is out of scope for role</div>`,
    newbie: `
      <div class="why-item">üìå <strong>SOP guide shown</strong>: 3mo exp ‚Üí needs explicit instructions</div>
      <div class="why-item">üìå <strong>Current step highlighted</strong>: Reduces cognitive load under stress</div>
      <div class="why-item">üìå <strong>Quick contacts shown</strong>: Should escalate, not repair</div>
      <div class="why-item">üìå <strong>Explanation added</strong>: Builds understanding, reduces anxiety</div>`
  };
  document.getElementById('whyContent').innerHTML = whyContent[role];
}

function renderWaferMap() {
  const map = document.getElementById('waferMap');
  map.innerHTML = '';

  const cols = 12, rows = 12;
  const radius = 88;
  const cx = 90, cy = 90;
  const cellSize = 13, gap = 2;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const x = c * (cellSize + gap) + 10;
      const y = r * (cellSize + gap) + 10;
      const dx = x + cellSize/2 - cx;
      const dy = y + cellSize/2 - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);

      if (dist > radius) continue;

      const cell = document.createElement('div');
      cell.className = 'wafer-cell';
      cell.style.left = x + 'px';
      cell.style.top = y + 'px';

      // Top-right quadrant = fail cluster
      const isFailZone = dx > 20 && dy < -20;
      const isEdge = dist > 70;
      const rand = Math.random();

      if (isEdge) {
        cell.style.background = '#6b7fa3';
      } else if (isFailZone) {
        cell.style.background = rand < 0.7 ? '#ef4444' : (rand < 0.9 ? '#f59e0b' : '#22c55e');
      } else {
        cell.style.background = rand < 0.95 ? '#22c55e' : (rand < 0.98 ? '#f59e0b' : '#ef4444');
      }

      map.appendChild(cell);
    }
  }
}

function renderSPC() {
  const container = document.getElementById('spcPoints');
  if (!container) return;

  const values = [];
  for (let i = 0; i < 20; i++) {
    let v;
    if (i < 16) v = 0.4 + Math.random() * 0.3; // normal
    else v = 0.1 + Math.random() * 0.2; // excursion
    values.push(v);
  }

  values.forEach((v, i) => {
    const bar = document.createElement('div');
    bar.className = 'spc-point';
    bar.style.height = '0%';
    bar.style.flex = '1';
    bar.style.background = i >= 16 ? '#ef4444' : '#00e5ff';
    bar.style.opacity = i >= 16 ? '1' : '0.5';
    container.appendChild(bar);

    setTimeout(() => {
      bar.style.height = (v * 80 + 5) + '%';
    }, i * 40);
  });
}

function toggleWhy() {
  document.getElementById('whyTooltip').classList.toggle('show');
}

document.addEventListener('click', (e) => {
  if (!e.target.closest('.why-btn') && !e.target.closest('.why-tooltip')) {
    document.getElementById('whyTooltip').classList.remove('show');
  }
});
</script>
</body>
</html>
